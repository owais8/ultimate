<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Question Generator</title>
    <!-- Add Bootstrap CSS link -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#">Ultimate</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="/">Home</a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" href="/generate_translate_questions">Generate Questions<span class="sr-only">(current)</span></a>
                </li>
            </ul>
        </div>
    </nav>
<div class="container mt-4">
    <h1 class="mb-4">Question Generator</h1>
    <form id="uploadForm" enctype="multipart/form-data">
        <label for="audioFile">Choose an MP3 file:</label>
        <input type="file" id="audioFile" name="file" accept=".mp3">
        <button type="button" onclick="transcribeAudio()">Transcribe</button>
    </form>

<form action="/generate_translate_questions" method="post">
    <div class="form-group">
        <label for="topic">Select a Topic:</label>
        <select class="form-control" id="topic" name="topic">
            <option value="science">Science</option>
            <option value="technology">Technology</option>
            <option value="history">History</option>
            <option value="education">Education</option>
            <option value="weather">Weather</option>
            <option value="food and dining">Food and Dining</option>


            <!-- Add more topics as needed -->
        </select>
    </div>
    <div class="form-group">
        <label for="language">Native Language of Application:</label>
        <select class="form-control" id="language" name="language">
            <option value="russian">Russian</option>
            <option value="french">French</option>
            <option value="spanish">Spanish</option>
            <!-- Add more languages as needed -->
        </select>
    </div>

    <button type="submit" class="btn btn-primary">Generate Questions</button>
</form>

<div class="mt-4" id="result">
    <h3>Generated Questions:</h3>

    {% if generated_questions %}
    <ul>
        {% for question in generated_questions %}
        <li>{{ question }}</li>
        <button class="btn btn-primary generate-audio-btn" data-question="{{ question }}">Generate Audio</button>
        <button class="btn btn-success generate-new-questions-btn" data-question="{{ question }}" onclick="generateNewQuestions('{{ question }}')">Generate New Questions</button>

        {% endfor %}
    </ul>
    <h3>Translated Questions:</h3>
    <ul>
        {% for translated_question in translated_questions %}
        <li>{{ translated_question }}</li>
        {% endfor %}
    </ul>
    {% endif %}
</div>

</div>

<!-- Add Bootstrap JS and Popper.js links -->
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>

        <script>
            function genrateQuestions(data){
                if (data.error) {
                document.getElementById('result').innerText = 'Error: ' + data.error;
            } else {
                document.getElementById('result').innerHTML = '';

                // Iterate through the questions array and create list items
                data.questions.forEach(question => {
                const listItem = document.createElement('li');
                listItem.textContent = question;

                const generateButton = document.createElement('button');
                generateButton.className = 'btn btn-primary generate-audio-btn';
                generateButton.setAttribute('data-question', question);
                generateButton.textContent = 'Generate Audio';

                const newQuestionsButton = document.createElement('button');
                newQuestionsButton.className = 'btn btn-success generate-new-questions-btn';
                newQuestionsButton.setAttribute('data-question', question);
                newQuestionsButton.textContent = 'Generate New Questions';
                newQuestionsButton.onclick = function () {
                    generateNewQuestions(question);
                };

                document.getElementById('result').appendChild(listItem);
                document.getElementById('result').appendChild(generateButton);
                document.getElementById('result').appendChild(newQuestionsButton);



                });
                data.translated_questions.forEach(question => {
                    const listItem = document.createElement('li');
                    listItem.textContent = question;
                    document.getElementById('result').appendChild(listItem);
                });

            }

            }
            function generateNewQuestions(clickedQuestion) {
                const selectedLanguage = document.getElementById('language').value;

        // Make an asynchronous request to the "generate_new_questions" endpoint
        fetch('/generate_new_questions', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ clickedQuestion: clickedQuestion, language:selectedLanguage }),
        })
        .then(response => response.json())
        .then(data => {
            genrateQuestions(data)
            // Handle the response (replace with your logic)
        })
        .catch(error => console.error('Error:', error));
    }
            document.addEventListener("DOMContentLoaded", function () {
            // Add an event listener to the document body, delegating the event handling
            document.body.addEventListener('click', function (event) {
                // Check if the clicked element is a "Generate Audio" button
                if (event.target.classList.contains('generate-audio-btn')) {

                    // Get the question text associated with the clicked button
                    var questionText = event.target.getAttribute('data-question');

                    // Make an asynchronous request to the "generate_audio" endpoint
                    fetch('/generate_audio', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ question: questionText }),
                    })
                    .then(response => response.json())
                    .then(data => {
                        // Display the video URL at the top of the page
                        var videoUrl = data.video_url;
                        var videoElement = document.createElement('video');
                        videoElement.src = videoUrl;
                        videoElement.controls = true;
                        videoElement.width = 300;  // Set the desired width
                        videoElement.height = 300; // Set the desired height

                        var resultDiv = document.getElementById('result');
                        var existingVideoElement = resultDiv.querySelector('video');
                        if (existingVideoElement) {
                            existingVideoElement.remove();
                        }

                        resultDiv.insertBefore(videoElement, resultDiv.firstChild);
                    })
                    .catch(error => console.error('Error:', error));
                }
            });

            // Rest of your existing code for the initial set of buttons
            // ...
        });

        function transcribeAudio() {
        const formData = new FormData(document.getElementById('uploadForm'));
        const selectedLanguage = document.getElementById('language').value;

        formData.append('language', selectedLanguage);

        fetch('/audio_processing', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            genrateQuestions(data)
        })
        .catch(error => {
            document.getElementById('result').innerText = 'Error: ' + error.message;
        });
    }
        </script>

</body>
</html>
